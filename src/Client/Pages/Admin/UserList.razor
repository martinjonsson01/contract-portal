@using Domain.Users
@inject HttpClient _http

<FetchData @ref="_dataFetcher"
           TData="List<User>"
           Url="/api/v1/users"
           Context="users">

    <h4>Dina kunder</h4>

    <table class="table table-striped table-responsive-md btn-table">
        <thead>
            <tr>
                <th scope="col">Namn</th>
                <th scope="col">Företag</th>
                <th scope="col">Senaste betalning</th>
                <th scope="col">Ta bort</th>
            </tr>
        </thead>

        <tbody>
            @foreach (User user in users)
            {
                <UserListItem User=@user OnUserRemoved="@OnUserRemoved"/>
            }
        </tbody>
    </table>

</FetchData>

@code {

    private FetchData<List<User>> _dataFetcher = null!;

    /// <summary>
    /// Adds a user to the list.
    /// </summary>
    /// <param name="user">The user to add.</param>
    public void Add(User user)
    {
        _dataFetcher.Data?.Add(user);
        InvokeAsync(StateHasChanged);
    }

    /// <summary>
    /// Removes a user from the list.
    /// </summary>
    /// <param name="user">The user to remove.</param>
    private void OnUserRemoved(User user)
    {
    // Using null forgiving operator because because _users
    // can not be null when remove button is pressed.
        _dataFetcher.Data!.Remove(user);
        InvokeAsync(StateHasChanged);
    }
}
